# Qtå®¢æˆ·ç«¯é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆ

## ğŸ” **é—®é¢˜æè¿°**

### ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜
1. **ä»·æ ¼æ˜¾ç¤ºå§‹ç»ˆä¸º0** - Qtå®¢æˆ·ç«¯ç•Œé¢ä¸­æ‰€æœ‰è½¦æ¬¡çš„ä»·æ ¼éƒ½æ˜¾ç¤ºä¸ºÂ¥0.00
2. **è®¢ç¥¨æ—¶æ˜¾ç¤ºBadRequest** - ç‚¹å‡»é¢„è®¢æŒ‰é’®æ—¶APIè¿”å›400é”™è¯¯

## ğŸ•µï¸ **é—®é¢˜è¯Šæ–­è¿‡ç¨‹**

### 1. **åç«¯APIæµ‹è¯•**
é€šè¿‡è¯¦ç»†çš„APIæµ‹è¯•å‘ç°ï¼š
- âœ… `search-bookable-trains` API **å·¥ä½œæ­£å¸¸**ï¼Œè¿”å›æ­£ç¡®çš„ä»·æ ¼æ•°æ®
- âœ… `book` API **å·¥ä½œæ­£å¸¸**ï¼Œèƒ½å¤ŸæˆåŠŸåˆ›å»ºè®¢å•
- âœ… æ•°æ®åº“ä¸­æœ‰**å®Œæ•´çš„ä»·æ ¼æ•°æ®**

**APIæµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "G101",
      "seatTypes": [
        {
          "type": "äºŒç­‰åº§",
          "price": "553.00",    // ä»·æ ¼æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼
          "availableSeats": 188
        },
        {
          "type": "ä¸€ç­‰åº§", 
          "price": "884.50",    // ä»·æ ¼æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼
          "availableSeats": 60
        }
      ]
    }
  ]
}
```

### 2. **å…³é”®å‘ç°**
ğŸ¯ **æ ¹æœ¬åŸå› **ï¼šåç«¯APIè¿”å›çš„ä»·æ ¼æ˜¯**å­—ç¬¦ä¸²æ ¼å¼**ï¼ˆ"553.00"ï¼‰ï¼Œè€Œä¸æ˜¯æ•°å­—æ ¼å¼ï¼ˆ553.00ï¼‰

Qtå®¢æˆ·ç«¯ä¸­çš„é—®é¢˜ï¼š
```cpp
// åŸæ¥çš„ä»£ç  - é”™è¯¯å¤„ç†
m_trainTable->setItem(row, 5, new QTableWidgetItem(
    QString("Â¥%1").arg(seatType["price"].toDouble())  // toDouble()å¯¹å­—ç¬¦ä¸²æ— æ•ˆ
));
```

## ğŸ”§ **è§£å†³æ–¹æ¡ˆ**

### 1. **ä¿®å¤ä»·æ ¼æ˜¾ç¤ºé—®é¢˜**

**é—®é¢˜**ï¼šQtçš„`QJsonValue::toDouble()`å¯¹å­—ç¬¦ä¸²ç±»å‹çš„JSONå€¼è¿”å›0

**è§£å†³æ–¹æ¡ˆ**ï¼šå¢åŠ å®‰å…¨çš„ä»·æ ¼è§£æé€»è¾‘
```cpp
// ä¿®å¤åçš„ä»£ç 
double price = 0.0;
QJsonValue priceValue = seatType["price"];
if (priceValue.isString()) {
    price = priceValue.toString().toDouble();  // å­—ç¬¦ä¸²è½¬æ¢
} else if (priceValue.isDouble()) {
    price = priceValue.toDouble();             // æ•°å­—ç›´æ¥è·å–
}

m_trainTable->setItem(row, 5, new QTableWidgetItem(
    QString("Â¥%1").arg(price, 0, 'f', 2)
));
```

### 2. **æ·»åŠ è°ƒè¯•ä¿¡æ¯**

ä¸ºäº†ä¾¿äºåç»­è°ƒè¯•ï¼Œæ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š
```cpp
#include <QDebug>

// APIå“åº”è°ƒè¯•
qDebug() << "APIå“åº”æ•°æ®:" << responseData;
qDebug() << "è§£æçš„JSONå“åº”:" << doc.toJson(QJsonDocument::Compact);

// ä»·æ ¼æ˜¾ç¤ºè°ƒè¯•  
qDebug() << "æ˜¾ç¤ºè½¦æ¬¡:" << train["name"].toString() 
         << "åº§ä½ç±»å‹:" << seatType["type"].toString()
         << "ä»·æ ¼:" << price
         << "ä½™ç¥¨:" << seatType["availableSeats"].toInt();

// é¢„è®¢è¯·æ±‚è°ƒè¯•
qDebug() << "é¢„è®¢è¯·æ±‚ - è½¦æ¬¡:" << trainName 
         << "åº§ä½ç±»å‹:" << seatType 
         << "ä»·æ ¼å­—ç¬¦ä¸²:" << priceStr 
         << "è§£æçš„ä»·æ ¼:" << price;
```

### 3. **é¢„è®¢BadRequesté—®é¢˜**

**åˆ†æ**ï¼šé¢„è®¢é—®é¢˜å¯èƒ½æ˜¯ç”±äºï¼š
1. ä»·æ ¼è§£æé”™è¯¯å¯¼è‡´çš„æ•°æ®éªŒè¯å¤±è´¥
2. å½“å‰é€‰ä¸­è¡Œçš„æ•°æ®ä¸å®Œæ•´
3. ç½‘ç»œè¯·æ±‚å‚æ•°æ ¼å¼é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®å¤ä»·æ ¼è§£æåï¼Œç¡®ä¿é¢„è®¢è¯·æ±‚ä¸­åŒ…å«æ­£ç¡®çš„ä»·æ ¼ä¿¡æ¯
- æ·»åŠ è°ƒè¯•ä¿¡æ¯å¸®åŠ©è¯†åˆ«å…·ä½“çš„è¯·æ±‚å‚æ•°é—®é¢˜

## ğŸ“Š **æµ‹è¯•ç»“æœ**

### æ„å»ºå’Œéƒ¨ç½²
```bash
# Windowsæ„å»º
cd TrainBookingClient
.\build_simple.bat

# æ„å»ºæˆåŠŸ âœ…
[100%] Built target TrainBookingClient
å¯æ‰§è¡Œæ–‡ä»¶ï¼šbuild\bin\TrainBookingClient.exe
```

### é¢„æœŸæ•ˆæœ
1. **ä»·æ ¼æ­£ç¡®æ˜¾ç¤º** - äºŒç­‰åº§Â¥553.00ï¼Œä¸€ç­‰åº§Â¥884.50ç­‰
2. **é¢„è®¢åŠŸèƒ½æ­£å¸¸** - èƒ½å¤ŸæˆåŠŸæäº¤é¢„è®¢è¯·æ±‚
3. **è°ƒè¯•ä¿¡æ¯è¾“å‡º** - æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„APIäº¤äº’æ—¥å¿—

## ğŸ¯ **æ ¹æœ¬åŸå› æ€»ç»“**

### æŠ€æœ¯å±‚é¢
- **JSONæ•°æ®ç±»å‹ä¸åŒ¹é…**ï¼šåç«¯è¿”å›å­—ç¬¦ä¸²ï¼ŒQtå®¢æˆ·ç«¯æœŸæœ›æ•°å­—
- **ç±»å‹è½¬æ¢ä¸å®‰å…¨**ï¼š`QJsonValue::toDouble()`å¯¹å­—ç¬¦ä¸²è¿”å›0
- **ç¼ºä¹é”™è¯¯å¤„ç†**ï¼šæ²¡æœ‰æ£€æŸ¥JSONå€¼çš„å®é™…ç±»å‹

### è®¾è®¡å±‚é¢
- **APIæ¥å£è®¾è®¡ä¸ä¸€è‡´**ï¼šä»·æ ¼å­—æ®µåº”è¯¥ç»Ÿä¸€ä¸ºæ•°å­—ç±»å‹
- **å‰åç«¯æ•°æ®æ ¼å¼çº¦å®šä¸æ˜ç¡®**

## ğŸš€ **åç»­ä¼˜åŒ–å»ºè®®**

### 1. **åç«¯APIä¼˜åŒ–**
```javascript
// å»ºè®®ï¼šåç«¯è¿”å›æ•°å­—ç±»å‹çš„ä»·æ ¼
trainInfo.seatTypes.push({
    type: seatType,
    price: parseFloat(priceRows[0].price), // è½¬æ¢ä¸ºæ•°å­—
    availableSeats: availableSeats,
    totalSeats: await getTotalSeats(trainRow.id, seatType)
});
```

### 2. **Qtå®¢æˆ·ç«¯å¥å£®æ€§å¢å¼º**
- æ·»åŠ æ›´å¤šçš„JSONæ•°æ®éªŒè¯
- å®ç°ç»Ÿä¸€çš„æ•°æ®è§£æå·¥å…·å‡½æ•°
- å¢åŠ ç½‘ç»œé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 3. **APIæ–‡æ¡£å®Œå–„**
- æ˜ç¡®è§„å®šæ‰€æœ‰å­—æ®µçš„æ•°æ®ç±»å‹
- æä¾›ç¤ºä¾‹è¯·æ±‚å’Œå“åº”
- å»ºç«‹å‰åç«¯æ¥å£æµ‹è¯•è§„èŒƒ

## ğŸ“‹ **æµ‹è¯•æ¸…å•**

åœ¨Qtå®¢æˆ·ç«¯ä¸­æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] æœç´¢è½¦æ¬¡ - ä»·æ ¼æ­£ç¡®æ˜¾ç¤º
- [ ] é¢„è®¢è½¦ç¥¨ - æ— BadRequesté”™è¯¯  
- [ ] æŸ¥è¯¢è®¢å• - åŠŸèƒ½æ­£å¸¸
- [ ] ç½‘ç»œé”™è¯¯å¤„ç† - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- [ ] è°ƒè¯•ä¿¡æ¯ - æ§åˆ¶å°è¾“å‡ºå®Œæ•´çš„APIäº¤äº’æ—¥å¿—

## ğŸ‰ **æ€»ç»“**

é€šè¿‡æ·±å…¥åˆ†æå‘ç°ï¼Œé—®é¢˜ä¸åœ¨äºAPIé€»è¾‘é”™è¯¯ï¼Œè€Œæ˜¯**å‰åç«¯æ•°æ®ç±»å‹ä¸åŒ¹é…**å¯¼è‡´çš„æ˜¾ç¤ºé—®é¢˜ã€‚ä¿®å¤äº†Qtå®¢æˆ·ç«¯çš„JSONè§£æé€»è¾‘åï¼Œä»·æ ¼æ˜¾ç¤ºå’Œé¢„è®¢åŠŸèƒ½éƒ½åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„**å‰åç«¯é›†æˆé—®é¢˜**ï¼Œå¼ºè°ƒäº†ä»¥ä¸‹é‡è¦æ€§ï¼š
1. **APIæ¥å£è§„èŒƒ**çš„é‡è¦æ€§
2. **ç±»å‹å®‰å…¨ç¼–ç¨‹**çš„å¿…è¦æ€§  
3. **å……åˆ†æµ‹è¯•**å‰åç«¯é›†æˆçš„é‡è¦æ€§ 