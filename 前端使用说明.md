# 前端HTML使用说明

## 概述

已成功修改 `mysql-test.html` 前端界面，使其完全符合后端API要求，能够正确实现车票预订流程。

## 主要修改内容

### 1. 预订流程优化

- **第一步**：填写乘客信息（姓名、身份证号）和行程信息（出发站、到达站、日期）
- **第二步**：选择车次和座位类型，系统自动分配最优座位

### 2. 参数传递修正

修复了以下关键问题：
- 确保 `trainId` 以数字形式传递给后端
- 参数名称与后端API完全匹配
- 添加了完整的输入验证

### 3. 用户体验改进

- 添加了详细的提示信息
- 优化了座位类型卡片显示（添加图标）
- 改进了预订成功页面的信息展示
- 增加了调试日志输出

### 4. 错误处理增强

- 更清晰的错误信息提示
- 输入验证防止无效提交
- 网络请求异常处理

## 使用方法

### 启动服务

1. 确保MySQL数据库正在运行
2. 启动后端服务：
   ```bash
   node back-end.js
   ```
3. 打开浏览器访问：`http://localhost:3000/mysql-test.html`

### 预订流程

1. **填写乘客信息**
   - 乘客姓名：输入真实姓名
   - 身份证号：输入18位身份证号
   - 出发站：从下拉菜单选择
   - 到达站：从下拉菜单选择
   - 出发日期：选择2025-07-17至2025-07-30之间的日期

2. **查询可预订车次**
   - 点击"查询可预订车次"按钮
   - 系统会显示符合条件的车次列表

3. **选择座位类型**
   - 浏览显示的车次信息
   - 点击想要的座位类型卡片
   - 确认预订信息
   - 系统自动完成座位分配

4. **预订完成**
   - 显示预订成功信息
   - 包含订单ID、座位号、价格等详细信息
   - 3秒后自动返回第一步，可继续预订

## 技术特点

### API集成

- **搜索API**: `POST /search-bookable-trains`
  - 参数：fromStation, toStation, date
  - 返回可预订车次列表，包含座位类型和余票信息

- **预订API**: `POST /book`
  - 参数：trainId, seatType, passengerName, passengerId, fromStation, toStation, date
  - 返回预订结果，包含座位分配详情

### 座位分配策略

- 按车厢号和座位号顺序分配
- 自动避免区间冲突
- 优先分配较前面的车厢和座位

### 数据验证

- 前端输入验证确保必填项完整
- 后端参数类型验证（如trainId转换为数字）
- 站点顺序验证防止无效路线

## 测试结果

通过API测试脚本验证：
- ✅ 搜索可预订车次功能正常
- ✅ 车票预订功能正常
- ✅ 座位自动分配正常
- ✅ 价格计算正确
- ✅ 订单生成成功

## 支持的路线

当前数据库包含以下站点：
- 北京 → 上海（经停：天津、济南、南京）
- 其他单向路线（如需双向可在数据库中添加）

## 常见问题

1. **找不到可预订车次**
   - 检查出发站和到达站是否在支持列表中
   - 确认日期在有效范围内（2025-07-17至2025-07-30）

2. **预订失败**
   - 检查座位是否已售完
   - 确认乘客信息格式正确
   - 查看控制台是否有错误信息

3. **页面无响应**
   - 确认后端服务正在运行
   - 检查网络连接
   - 查看浏览器控制台的错误信息

## 进一步优化建议

1. 添加实时座位图显示
2. 支持多乘客预订
3. 添加支付功能
4. 实现订单状态实时更新
5. 增加车次时刻表详细显示 